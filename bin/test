#!/usr/bin/env ruby
# test a running bayes bot with a given dataset

$: << "."

require 'lib/datafile'
require 'lib/redis_bayes'
require 'net/http'
require 'uri'

file = DataFile.new(ARGV.first)

Net::HTTP.start("localhost", "3000") do |http|
  correct = 0
  total = 0
  file.each do |c,f|
    fparams = f.collect { |i| "f[]=" + URI::encode(i.join(RedisBayes::SEPARATOR)) }
    query = "/?" + fparams.join("&")
    resp = http.get(query).body.strip
    total += 1
    correct +=1 if resp == c
    puts "#{c} => #{resp}"
  end
  puts correct.to_f / total
end
