#!/usr/bin/env ruby
# test a running bayes bot with a given dataset

$: << File.join(File.dirname(__FILE__), "..", "lib")

require 'datafile'
require 'net/http'

file = DataFile.new(ARGV.first)

Net::HTTP.start("localhost", "3000") do |http|
  correct = 0
  file.points.each do |c,f|
    query = "/?" + f.collect { |i| "f[]=#{i}" }.join("&")
    resp = http.get(query).body.strip
    correct +=1 if resp == c
    puts "#{c} => #{resp}"
  end
  puts correct.to_f / file.points.size
end
