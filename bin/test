#!/usr/bin/env python
# test a running bayes bot with a given dataset

from __future__ import division
import brains
import httplib
import sys
import urllib

def main():
    sep = "__"
    df = brains.DataFile(sys.argv[1])
    c = httplib.HTTPConnection("localhost", 5000)
    correct = 0
    for klass, feats in df.points():
        feats = [("f", sep.join(i)) for i in feats.items()]
        d = urllib.urlencode(feats)
        c.request("GET", "/?" + d)
        resp = c.getresponse().read()
        if klass == resp:
            correct += 1
        print("{} => {}".format(klass, resp))
    print(correct / df.count)

main()        

